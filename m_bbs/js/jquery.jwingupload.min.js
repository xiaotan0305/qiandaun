/*!
 * jWing JavaScript Library v1.0.0
 * http://jwing.com/
 *
 * Includes jquery.js
 * http://jquery.com/
 *
 * Copyright 2013 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jwing.org/license
 *
 * Date: 2013-5-8
 * Auth: yueyanlei
 */
(function(d,a){var b=d.jQuery,f=d.document,e="1.0.0",j=[],c=function(k){k=k||{};var m=c.defaults,l;for(l in m){if(k[l]===a){k[l]=m[l]}}return new c.fn.init(k)};c.fn=c.prototype={version:e,constructor:c,init:function(m){var q=this,n=0,r={},p=b(m.form);picBlock=b(m.uploadPic),preBlock=b(m.preview),iframe=b(m.iframe);q.imgList=[];var o=navigator.userAgent,l=o.toLowerCase();if(l.indexOf("ipad")>=0||l.indexOf("iphone")>=0||l.indexOf("ipod")>=0){o=l.split(" ").join("");var k=o.split("iphoneos").pop();if(Number(k.substr(0,1))<6){return this}}picBlock.css("display","inline-block");this.dom=r;this.config=m;r.form=p;r.picBlock=picBlock;r.preBlock=preBlock;r.iframe=iframe;r.input=b("<input/>").attr({type:"file",name:"pic",id:"pic",accept:"image/*","class":"upload-input"}).appendTo(picBlock);r.uploadurl=p.attr("action");r.nowItem=null;r.input.bind("click",function(u){var t=null,s=false;if(q.imgList<1){s=true}else{b.each(q.imgList,function(v,w){var x=w.dom;if(((!x.imgurl)||x.imgurl.length<0)&&x.holder==false){t=w;s=true;return false}})}if(s==true){r.input.unbind("change").bind("change",{m:q,d:t},g)}else{r.input.unbind("change");alert("\u60A8\u5DF2\u7ECF\u9009\u62E9\u4E86"+q.imgList.length+"\u5F20\u56FE\u7247")}return s});return this},length:0,showMesg:function(k){var l=this;l.newitem.html(k)},createPreview:function(){var l=this,m=l.dom,k=b(c._template).appendTo(m.preBlock);m.preBlock.css("display","inline-block");k.find("dd").attr({"class":"add"}).each(function(o,p){var n=b(p),q={};q.index=o;q.input=b("<input/>").attr({type:"file",name:"pic"+o,id:"pic"+o,accept:"image/*","class":"upload-input"}).appendTo(p).bind("change",{m:l,d:n},g);q.img=b('<img src="'+l.config.imgpath+'images/loading.gif" style="margin:10px 9px 9px 10px;width:31px; height:31px;">');q.closebtn=b('<a href="javascript:;">&#88;</a>');q.imgurl="";q.holder=false;n.dom=q;n.css("visibility","hidden");l.imgList.push(n)})},push:j.push,sort:j.sort,splice:j.splice};c.fn.init.prototype=c.fn;function i(m,k){var l=m.dom.iframe.get(0),n=k.dom;doc=l.contentDocument||l.contentWindow.document;m.holder=false;n.holder=false;if(doc&&doc.readyState&&doc.readyState=="complete"){n.imgurl=doc.getElementsByTagName("div")[0].innerHTML;if(n.imgurl){n.img.attr("src",n.imgurl).unbind("load").bind("load",function(o){n.img.css({margin:"0px",width:"50px",height:"50px"});k.append(n.closebtn.unbind("click").bind("click",{m:m,d:k},h))})}else{alert("\u4E0A\u4F20\u5931\u8D25\uFF0C\u8BF7\u91CD\u65B0\u4E0A\u4F20");h({m:m,d:k})}}}function g(p){var o=p.data,n=o.m,k=o.d,m=p.target.files,l=n.dom.form.get(0);iframe=n.dom.iframe.get(0),input=p.target;if(m.length>0){if(n.holder==true){input.value="";alert("\u6709\u4E00\u5F20\u56FE\u7247\u6B63\u5728\u4E0A\u4F20\uFF0C\u8BF7\u5B8C\u6210\u540E\u518D\u8BD5");return false}if(!(n.imgList)||n.imgList.length<1){n.createPreview();k=n.imgList[0]}k.css("visibility","visible");k.dom.holder=true;if(n.imgList[k.dom.index+1]){n.imgList[k.dom.index+1].css("visibility","visible")}l.onsubmit=function(q){return true};iframe.onload=function(q){i(n,k)};l.action=n.dom.uploadurl+"&rand="+new Date().getTime();n.holder=true;l.submit();setTimeout(function(q){input.value="";k.removeClass("add").empty().append(k.dom.img.attr("src",n.config.imgpath+"images/loading.gif").css({margin:"10px 9px 9px 10px",width:"31px",height:"31px"}))},10)}else{l.onsubmit=function(q){return false}}}function h(n){var m=n.data,l=m.m,k=m.d;k.addClass("add").empty().append(k.dom.input.unbind("change").bind("change",{m:l,d:k},g));k.dom.imgurl=""}c.defaults={form:null,uploadPic:null,preview:null,iframe:null};c._template="<dl><dd></dd><dd></dd><dd></dd><dd></dd></dl>";d.jWingUpload=c})(window);