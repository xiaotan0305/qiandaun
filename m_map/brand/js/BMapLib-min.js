var BMapLib=window.BMapLib=BMapLib||{};(function(){var a=a||{guid:"$BAIDU$"};(function(){window[a.guid]={};a.extend=function(h,f){for(var g in f){if(f.hasOwnProperty(g)){h[g]=f[g]}}return h};a.lang=a.lang||{};a.lang.guid=function(){return"TANGRAM__"+(window[a.guid]._counter++).toString(36)};window[a.guid]._counter=window[a.guid]._counter||1;window[a.guid]._instances=window[a.guid]._instances||{};a.lang.Class=function(f){this.guid=f||a.lang.guid();window[a.guid]._instances[this.guid]=this};window[a.guid]._instances=window[a.guid]._instances||{};a.lang.isString=function(f){return"[object String]"==Object.prototype.toString.call(f)};a.isString=a.lang.isString;a.lang.isFunction=function(f){return"[object Function]"==Object.prototype.toString.call(f)};a.lang.Event=function(f,g){this.type=f;this.returnValue=true;this.target=g||null;this.currentTarget=null};a.lang.Class.prototype.addEventListener=function(i,h,g){if(!a.lang.isFunction(h)){return}!this.__listeners&&(this.__listeners={});var f=this.__listeners,j;if(typeof g=="string"&&g){if(/[^\w\-]/.test(g)){throw ("nonstandard key:"+g)}else{h.hashCode=g;j=g}}i.indexOf("on")!=0&&(i="on"+i);typeof f[i]!="object"&&(f[i]={});j=j||a.lang.guid();h.hashCode=j;f[i][j]=h};a.lang.Class.prototype.removeEventListener=function(h,g){if(a.lang.isFunction(g)){g=g.hashCode}else{if(!a.lang.isString(g)){return}}!this.__listeners&&(this.__listeners={});h.indexOf("on")!=0&&(h="on"+h);var f=this.__listeners;if(!f[h]){return}f[h][g]&&delete f[h][g]};a.lang.Class.prototype.dispatchEvent=function(j,f){if(a.lang.isString(j)){j=new a.lang.Event(j)}!this.__listeners&&(this.__listeners={});f=f||{};for(var h in f){j[h]=f[h]}var h,g=this.__listeners,k=j.type;j.target=j.target||this;j.currentTarget=this;k.indexOf("on")!=0&&(k="on"+k);a.lang.isFunction(this[k])&&this[k].apply(this,arguments);if(typeof g[k]=="object"){for(h in g[k]){g[k][h].apply(this,arguments)}}return j.returnValue};a.dom=a.dom||{};a.dom._g=function(f){if(a.lang.isString(f)){return document.getElementById(f)}return f};a._g=a.dom._g;a.event=a.event||{};a.event._listeners=a.event._listeners||[];a.event.on=function(g,j,l){j=j.replace(/^on/i,"");g=a.dom._g(g);var k=function(n){l.call(g,n)},f=a.event._listeners,i=a.event._eventFilter,m,h=j;j=j.toLowerCase();if(i&&i[j]){m=i[j](g,j,k);h=m.type;k=m.listener}if(g.addEventListener){g.addEventListener(h,k,false)}else{if(g.attachEvent){g.attachEvent("on"+h,k)}}f[f.length]=[g,j,l,k,h];return g};a.on=a.event.on;a.event.un=function(h,k,g){h=a.dom._g(h);k=k.replace(/^on/i,"").toLowerCase();var n=a.event._listeners,i=n.length,j=!g,m,l,f;while(i--){m=n[i];if(m[1]===k&&m[0]===h&&(j||m[2]===g)){l=m[4];f=m[3];if(h.removeEventListener){h.removeEventListener(l,f,false)}else{if(h.detachEvent){h.detachEvent("on"+l,f)}}n.splice(i,1)}}return h};a.un=a.event.un;a.preventDefault=a.event.preventDefault=function(f){if(f.preventDefault){f.preventDefault()}else{f.returnValue=false}}})();var e=BMapLib.RichMarker=function(h,f,g){if(!h||!f||!(f instanceof BMap.Point)){return}this._map=null;this._content=h;this._position=f;this._container=null;this._size=null;g=g||{};this._opts=a.extend(a.extend(this._opts||{},{enableDragging:false,anchor:new BMap.Size(0,0)}),g)};e.prototype=new BMap.Overlay();e.prototype.initialize=function(g){var f=this,h=f._container=document.createElement("div");f._map=g;a.extend(h.style,{position:"absolute",zIndex:BMap.Overlay.getZIndex(f._position.lat),background:"none",cursor:"pointer"});g.getPanes().labelPane.appendChild(h);f._appendContent();f._setEventDispath();f._getContainerSize();return h};e.prototype.draw=function(){var h=this._map,g=this._opts.anchor,f=h.pointToOverlayPixel(this._position);this._container.style.left=f.x+g.width+"px";this._container.style.top=f.y+g.height+"px"};e.prototype.enableDragging=function(){this._opts.enableDragging=true};e.prototype.disableDragging=function(){this._opts.enableDragging=false};e.prototype.isDraggable=function(){return this._opts.enableDragging};e.prototype.getPosition=function(){return this._position};e.prototype.setPosition=function(f){if(!f instanceof BMap.Point){return}this._position=f;this.draw()};e.prototype.getAnchor=function(){return this._opts.anchor};e.prototype.setAnchor=function(f){if(!f instanceof BMap.Size){return}this._opts.anchor=f;this.draw()};e.prototype._appendContent=function(){var g=this._content;if(typeof g=="string"){var h=document.createElement("DIV");h.innerHTML=g;if(h.childNodes.length==1){g=(h.removeChild(h.firstChild))}else{var f=document.createDocumentFragment();while(h.firstChild){f.appendChild(h.firstChild)}g=f}}this._container.innerHTML="";this._container.appendChild(g)};e.prototype.getContent=function(){return this._content};e.prototype.setContent=function(f){if(!f){return}this._content=f;this._appendContent()};e.prototype._getContainerSize=function(){if(!this._container){return}var g=this._container.offsetHeight;var f=this._container.offsetWidth;this._size=new BMap.Size(f,g)};e.prototype.getWidth=function(){if(!this._size){return}return this._size.width};e.prototype.setWidth=function(f){if(!this._container){return}this._container.style.width=f+"px";this._getContainerSize()};e.prototype.getHeight=function(){if(!this._size){return}return this._size.height};e.prototype.setHeight=function(f){if(!this._container){return}this._container.style.height=f+"px";this._getContainerSize()};e.prototype._setEventDispath=function(){var k=this,l=k._container,g=false,i=null;function j(p){var p=window.event||p,n=p.pageX||p.clientX||0,q=p.pageY||p.clientY||0,o=new BMap.Pixel(n,q),m=k._map.pixelToPoint(o);return{pixel:o,point:m}}a.on(l,"onclick",function(m){c(k,"onclick");d(m)});a.on(l,"ondblclick",function(n){var m=j(n);c(k,"ondblclick",{point:m.point,pixel:m.pixel});d(n)});l.onmouseover=function(n){var m=j(n);c(k,"onmouseover",{point:m.point,pixel:m.pixel});d(n)};l.onmouseout=function(n){var m=j(n);c(k,"onmouseout",{point:m.point,pixel:m.pixel});d(n)};var h=function(n){var m=j(n);c(k,"onmouseup",{point:m.point,pixel:m.pixel});if(k._container.releaseCapture){a.un(l,"onmousemove",f);a.un(l,"onmouseup",h)}else{a.un(window,"onmousemove",f);a.un(window,"onmouseup",h)}if(!k._opts.enableDragging){d(n);return}k._container.releaseCapture&&k._container.releaseCapture();c(k,"ondragend",{point:m.point,pixel:m.pixel});g=false;i=null;k._setCursor("dragend");k._container.style.MozUserSelect="";k._container.style.KhtmlUserSelect="";k._container.style.WebkitUserSelect="";k._container.unselectable="off";k._container.onselectstart=function(){};d(n)};var f=function(o){if(!k._opts.enableDragging||!g){return}var n=j(o);var p=k._map.pointToPixel(k._position);var m=n.pixel.x-i.x+p.x;var q=n.pixel.y-i.y+p.y;i=n.pixel;k._position=k._map.pixelToPoint(new BMap.Pixel(m,q));k.draw();k._setCursor("dragging");c(k,"ondragging",{point:n.point,pixel:n.pixel});d(o)};a.on(l,"onmousedown",function(n){var m=j(n);c(k,"onmousedown",{point:m.point,pixel:m.pixel});if(k._container.setCapture){a.on(l,"onmousemove",f);a.on(l,"onmouseup",h)}else{a.on(window,"onmousemove",f);a.on(window,"onmouseup",h)}if(!k._opts.enableDragging){d(n);return}i=m.pixel;c(k,"ondragstart",{point:m.point,pixel:m.pixel});g=true;k._setCursor("dragstart");k._container.setCapture&&k._container.setCapture();k._container.style.MozUserSelect="none";k._container.style.KhtmlUserSelect="none";k._container.style.WebkitUserSelect="none";k._container.unselectable="on";k._container.onselectstart=function(){return false};d(n)})};e.prototype._setCursor=function(f){var h="";var g={moz:{dragstart:"-moz-grab",dragging:"-moz-grabbing",dragend:"pointer"},other:{dragstart:"move",dragging:"move",dragend:"pointer"}};if(navigator.userAgent.indexOf("Gecko/")!==-1){h=g.moz[f]}else{h=g.other[f]}if(this._container.style.cursor!=h){this._container.style.cursor=h}};e.prototype.remove=function(){c(this,"onremove");if(this._container){b(this._container)}if(this._container&&this._container.parentNode){this._container.parentNode.removeChild(this._container)}};function c(f,g,i){g.indexOf("on")!=0&&(g="on"+g);var h=new a.lang.Event(g);if(!!i){for(var j in i){h[j]=i[j]}}f.dispatchEvent(h)}function b(j){if(!j){return}var g=j.attributes,f="";if(g){for(var h=0,l=g.length;h<l;h++){f=g[h].name;if(typeof j[f]==="function"){j[f]=null}}}var k=j.childnodes;if(k){for(var h=0,l=k.length;h<l;h++){b(j.childnodes[h])}}}function d(f){var f=window.event||f;f.stopPropagation?f.stopPropagation():f.cancelBubble=true;return a.preventDefault(f)}})();(function(){var c=c||{guid:"$BAIDU$"};(function(){window[c.guid]={};c.extend=function(g,e){for(var f in e){if(e.hasOwnProperty(f)){g[f]=e[f]}}return g};c.lang=c.lang||{};c.lang.guid=function(){return"TANGRAM__"+(window[c.guid]._counter++).toString(36)};window[c.guid]._counter=window[c.guid]._counter||1;window[c.guid]._instances=window[c.guid]._instances||{};c.lang.Class=function(e){this.guid=e||c.lang.guid();window[c.guid]._instances[this.guid]=this};window[c.guid]._instances=window[c.guid]._instances||{};c.lang.isString=function(e){return"[object String]"==Object.prototype.toString.call(e)};c.lang.isFunction=function(e){return"[object Function]"==Object.prototype.toString.call(e)};c.lang.Class.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"};c.lang.Class.prototype.dispose=function(){delete window[c.guid]._instances[this.guid];for(var e in this){if(!c.lang.isFunction(this[e])){delete this[e]}}this.disposed=true};c.lang.Event=function(e,f){this.type=e;this.returnValue=true;this.target=f||null;this.currentTarget=null};c.lang.Class.prototype.addEventListener=function(h,g,f){if(!c.lang.isFunction(g)){return}!this.__listeners&&(this.__listeners={});var e=this.__listeners,i;if(typeof f=="string"&&f){if(/[^\w\-]/.test(f)){throw ("nonstandard key:"+f)}else{g.hashCode=f;i=f}}h.indexOf("on")!=0&&(h="on"+h);typeof e[h]!="object"&&(e[h]={});i=i||c.lang.guid();g.hashCode=i;e[h][i]=g};c.lang.Class.prototype.removeEventListener=function(g,f){if(c.lang.isFunction(f)){f=f.hashCode}else{if(!c.lang.isString(f)){return}}!this.__listeners&&(this.__listeners={});g.indexOf("on")!=0&&(g="on"+g);var e=this.__listeners;if(!e[g]){return}e[g][f]&&delete e[g][f]};c.lang.Class.prototype.dispatchEvent=function(h,e){if(c.lang.isString(h)){h=new c.lang.Event(h)}!this.__listeners&&(this.__listeners={});e=e||{};for(var g in e){h[g]=e[g]}var g,f=this.__listeners,j=h.type;h.target=h.target||this;h.currentTarget=this;j.indexOf("on")!=0&&(j="on"+j);c.lang.isFunction(this[j])&&this[j].apply(this,arguments);if(typeof f[j]=="object"){for(g in f[j]){f[j][g].apply(this,arguments)}}return h.returnValue};c.lang.inherits=function(k,i,h){var g,j,e=k.prototype,f=new Function();f.prototype=i.prototype;j=k.prototype=new f();for(g in e){j[g]=e[g]}k.prototype.constructor=k;k.superClass=i.prototype;if("string"==typeof h){j._className=h}};c.dom=c.dom||{};c._g=c.dom._g=function(e){if(c.lang.isString(e)){return document.getElementById(e)}return e};c.g=c.dom.g=function(e){if("string"==typeof e||e instanceof String){return document.getElementById(e)}else{if(e&&e.nodeName&&(e.nodeType==1||e.nodeType==9)){return e}}return null};c.insertHTML=c.dom.insertHTML=function(h,e,g){h=c.dom.g(h);var f,i;if(h.insertAdjacentHTML){h.insertAdjacentHTML(e,g)}else{f=h.ownerDocument.createRange();e=e.toUpperCase();if(e=="AFTERBEGIN"||e=="BEFOREEND"){f.selectNodeContents(h);f.collapse(e=="AFTERBEGIN")}else{i=e=="BEFOREBEGIN";f[i?"setStartBefore":"setEndAfter"](h);f.collapse(i)}f.insertNode(f.createContextualFragment(g))}return h};c.ac=c.dom.addClass=function(k,m){k=c.dom.g(k);var f=m.split(/\s+/),e=k.className,j=" "+e+" ",h=0,g=f.length;for(;h<g;h++){if(j.indexOf(" "+f[h]+" ")<0){e+=(e?" ":"")+f[h]}}k.className=e;return k};c.event=c.event||{};c.event._listeners=c.event._listeners||[];c.on=c.event.on=function(f,i,k){i=i.replace(/^on/i,"");f=c._g(f);var j=function(m){k.call(f,m)},e=c.event._listeners,h=c.event._eventFilter,l,g=i;i=i.toLowerCase();if(h&&h[i]){l=h[i](f,i,j);g=l.type;j=l.listener}if(f.addEventListener){f.addEventListener(g,j,false)}else{if(f.attachEvent){f.attachEvent("on"+g,j)}}e[e.length]=[f,i,k,j,g];return f};c.un=c.event.un=function(g,j,f){g=c._g(g);j=j.replace(/^on/i,"").toLowerCase();var m=c.event._listeners,h=m.length,i=!f,l,k,e;while(h--){l=m[h];if(l[1]===j&&l[0]===g&&(i||l[2]===f)){k=l[4];e=l[3];if(g.removeEventListener){g.removeEventListener(k,e,false)}else{if(g.detachEvent){g.detachEvent("on"+k,e)}}m.splice(h,1)}}return g};c.preventDefault=c.event.preventDefault=function(e){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}}})();var d=BMapLib.DistanceTool=function(f,e){if(!f){return}this._map=f;e=e||{};this._opts=c.extend(c.extend(this._opts||{},{tips:"\u6d4b\u8ddd",followText:"\u5355\u51fb\u786e\u5b9a\u5730\u70b9\uff0c\u53cc\u51fb\u7ed3\u675f",unit:"metric",lineColor:"#ff6319",lineStroke:2,opacity:0.8,lineStyle:"solid",cursor:"http://api.map.baidu.com/images/ruler.cur",secIcon:null,closeIcon:null}),e);this._followTitle=null;this._points=[];this._paths=[];this._dots=[];this._segDistance=[];this._overlays=[];this._enableMassClear=true,this._units={metric:{name:"metric",conv:1,incon:1000,u1:"\u7c73",u2:"\u516c\u91cc"},us:{name:"us",conv:3.2808,incon:5279.856,u1:"\u82f1\u5c3a",u2:"\u82f1\u91cc"}};this._isOpen=false;this._startFollowText="\u5355\u51fb\u786e\u5b9a\u8d77\u70b9";this._movingTimerId=null;this._styles={BMapLib_diso:"height:17px;width:5px;position:absolute;background:url(http://api.map.baidu.com/images/dis_box_01.gif) no-repeat left top",BMapLib_disi:"color:#7a7a7a;position:absolute;left:5px;padding:0 4px 1px 0;line-height:17px;background:url(http://api.map.baidu.com/images/dis_box_01.gif) no-repeat right top",BMapLib_disBoxDis:"color:#ff6319;font-weight:bold"};if(this._opts.lineStroke<=0){this._opts.lineStroke=2}if(this._opts.opacity>1){this._opts.opacity=1}else{if(this._opts.opacity<0){this._opts.opacity=0}}if(this._opts.lineStyle!="solid"&&this._opts.lineStyle!="dashed"){this._opts.lineStyle="solid"}if(!this._units[this._opts.unit]){this._opts.unit="metric"}this.text="\u6d4b\u8ddd"};c.lang.inherits(d,c.lang.Class,"DistanceTool");d.prototype._bind=function(){this._setCursor(this._opts.cursor);var f=this;c.on(this._map.getContainer(),"mousemove",function(i){if(!f._isOpen){return}if(!f._followTitle){return}i=window.event||i;var g=i.target||i.srcElement;if(g!=a.getDom(f._map)){f._followTitle.hide();return}if(!f._mapMoving){f._followTitle.show()}var h=a.getDrawPoint(i,true);f._followTitle.setPosition(h)});if(this._startFollowText){var e=this._followTitle=new BMap.Label(this._startFollowText,{offset:new BMap.Size(14,16)});this._followTitle.setStyles({color:"#333",borderColor:"#ff0103"})}};d.prototype.open=function(){if(this._isOpen==true){return true}if(!!BMapLib._toolInUse){return}this._isOpen=true;BMapLib._toolInUse=true;if(this._mapMoving){delete this._mapMoving}var h=this;if(!this._binded){this._binded=true;this._bind();this._map.addEventListener("moving",function(){h._hideCurrent()})}if(this._followTitle){this._map.addOverlay(this._followTitle);this._followTitle.hide()}var g=function(q){var l=h._map;if(!h._isOpen){return}q=window.event||q;var n=a.getDrawPoint(q,true);if(!h._isPointValid(n)){return}h._bind.initX=q.pageX||q.clientX||0;h._bind.initY=q.pageY||q.clientY||0;if(h._points.length>0){var t=l.pointToPixel(h._points[h._points.length-1]);var m=l.pointToPixel(n);var p=Math.sqrt(Math.pow(t.x-m.x,2)+Math.pow(t.y-m.y,2));if(p<5){return}}h._bind.x=q.layerX||q.offsetX||0;h._bind.y=q.layerY||q.offsetY||0;h._points.push(n);h._addSecPoint(n);if(h._paths.length==0){h._formatTitle(1,h._opts.followText,h._getTotalDistance())}if(h._paths.length>0){h._paths[h._paths.length-1].show();h._paths[h._paths.length-1].setStrokeOpacity(h._opts.opacity)}var w=new BMap.Polyline([n,n],{enableMassClear:h._enableMassClear});h._map.addOverlay(w);h._paths.push(w);h._overlays.push(w);w.setStrokeWeight(h._opts.lineStroke);w.setStrokeColor(h._opts.lineColor);w.setStrokeOpacity(h._opts.opacity/2);w.setStrokeStyle(h._opts.lineStyle);if(h._mapMoving){w.hide()}if(h._points.length>1){var o=h._paths[h._points.length-2];o.setPositionAt(1,n)}var r="";if(h._points.length>1){var u=h._setSegDistance(h._points[h._points.length-2],h._points[h._points.length-1]);var s=h._getTotalDistance();r=h._formatDisStr(s)}else{r="\u8d77\u70b9"}var v=new BMap.Label(r,{offset:new BMap.Size(10,-5),enableMassClear:h._enableMassClear});v.setStyles({color:"#333",borderColor:"#ff0103"});h._map.addOverlay(v);h._formatSegLabel(v,r);h._overlays.push(v);n.disLabel=v;v.setPosition(n);var k=new c.lang.Event("onaddpoint");k.point=n;k.pixel=h._map.pointToPixel(n);k.index=h._points.length-1;k.distance=h._getTotalDistance().toFixed(0);h.dispatchEvent(k)};var f=function(p){if(!h._isOpen){return}if(h._paths.length>0){p=window.event||p;var l=p.pageX||p.clientX||0;var k=p.pageY||p.clientY||0;if(typeof h._bind.initX=="undefined"){h._bind.x=p.layerX||p.offsetX||0;h._bind.y=p.layerY||p.offsetY||0;h._bind.initX=l;h._bind.initY=k}var r=h._bind.x+l-h._bind.initX;var q=h._bind.y+k-h._bind.initY;var z=h._paths[h._paths.length-1];var m=h._map.pixelToPoint(new BMap.Pixel(r,q));z.setPositionAt(1,m);if(!h._mapMoving){z.show()}var A=0;var u=0;if(r<10){A=8}else{if(r>h._map.getSize().width-10){A=-8}}if(q<10){u=8}else{if(q>h._map.getSize().height-10){u=-8}}if(A!=0||u!=0){if(!f._movingTimerId){h._mapMoving=true;h._map.panBy(A,u,{noAnimation:true});h._movingTimerId=f._movingTimerId=setInterval(function(){h._map.panBy(A,u,{noAnimation:true})},30);z.hide();h._followTitle&&h._followTitle.hide()}}else{if(f._movingTimerId){clearInterval(f._movingTimerId);delete f._movingTimerId;delete h._movingTimerId;var w=h._paths[h._paths.length-1];var v=h._map.pixelToPoint(new BMap.Pixel(r,q));if(!w){return}w.setPositionAt(1,v);w.show();if(h._followTitle){h._followTitle.setPosition(v);h._followTitle.show()}h._bind.i=0;h._bind.j=0;delete h._mapMoving}}if(h._followTitle){var o=h._getTotalDistance();var n=h._map.getDistance(h._points[h._points.length-1],m);h._updateInstDis(h._followTitle,o+n)}}else{if(h._followTitle){h._followTitle.show();p=window.event||p;var s=p.target||p.srcElement;if(s!=a.getDom()){h._followTitle.hide()}}}};var e=function(k){if(!h._isOpen){return}c.un(a.getDom(h._map),"click",g);c.un(document,"mousemove",f);c.un(a.getDom(h._map),"dblclick",e);c.un(document,"keydown",j);c.un(a.getDom(h._map),"mouseup",i);setTimeout(function(){h.close()},50)};var j=function(k){k=window.event||k;if(k.keyCode==27){h._clearCurData();setTimeout(function(){h.close()},50)}};var i=function(k){k=window.event||k;var l=0;if(/msie (\d+\.\d)/i.test(navigator.userAgent)){l=document.documentMode||+RegExp["\x241"]}if(l&&k.button!=1||k.button==2){h.close()}};h._initData();this._formatTitle();a.show(this._map);this._setCursor(this._opts.cursor);c.on(a.getDom(this._map),"click",g);c.on(document,"mousemove",f);c.on(a.getDom(this._map),"dblclick",e);c.on(document,"keydown",j);c.on(a.getDom(this._map),"mouseup",i);this.bindFunc=[{elem:a.getDom(this._map),type:"click",func:g},{elem:a.getDom(this._map),type:"dblclick",func:e},{elem:document,type:"mousemove",func:f},{elem:document,type:"keydown",func:j},{elem:a.getDom(this._map),type:"mouseup",func:i}];return true};d.prototype._dispatchLastEvent=function(){var e=new c.lang.Event("ondrawend");e.points=this._points?this._points.slice(0):[];e.overlays=this._paths?this._paths.slice(0,this._paths.length-1):[];e.distance=this._getTotalDistance().toFixed(0);this.dispatchEvent(e)};d.prototype.close=function(){if(this._isOpen==false){return}this._isOpen=false;BMapLib._toolInUse=false;if(this._mapMoving){delete this._mapMoving}var g=this;g._dispatchLastEvent();if(g._points.length<2){g._clearCurData()}else{g._paths[g._paths.length-1].remove();g._paths[g._paths.length-1]=null;g._paths.length=g._paths.length-1;var h=g._points[g._points.length-1];if(h.disLabel){h.disLabel.remove()}g._processLastOp()}a.hide();for(var f=0,e=this.bindFunc.length;f<e;f++){c.un(this.bindFunc[f].elem,this.bindFunc[f].type,this.bindFunc[f].func)}if(g._movingTimerId){clearInterval(g._movingTimerId);g._movingTimerId=null}if(this._followTitle){this._followTitle.hide()}};d.prototype._clearCurData=function(){for(var f=0,e=this._points.length;f<e;f++){if(this._points[f].disLabel){this._points[f].disLabel.remove()}}for(var f=0,e=this._paths.length;f<e;f++){this._paths[f].remove()}for(var f=0,e=this._dots.length;f<e;f++){this._dots[f].remove()}this._initData()};d.prototype._initData=function(){this._points.length=0;this._paths.length=0;this._segDistance.length=0;this._dots.length=0};d.prototype._setSegDistance=function(g,f){if(!g||!f){return}var e=this._map.getDistance(g,f);this._segDistance.push(e);return e};d.prototype._getTotalDistance=function(){var g=0;for(var f=0,e=this._segDistance.length;f<e;f++){g+=this._segDistance[f]}return g};d.prototype._convertUnit=function(e,f){f=f||"metric";if(this._units[f]){return e*this._units[f].conv}return e};d.prototype._addSecPoint=function(g){var f=this._opts.secIcon?this._opts.secIcon:new BMap.Icon("http://api.map.baidu.com/images/mapctrls.png",new BMap.Size(11,11),{imageOffset:new BMap.Size(-26,-313)});var e=new BMap.Marker(g,{icon:f,clickable:false,baseZIndex:3500000,zIndexFixed:true,enableMassClear:this._enableMassClear});this._map.addOverlay(e);this._dots.push(e)};d.prototype._formatDisStr=function(h){var f=this._opts.unit;var g=this._units[f].u1;var e=this._convertUnit(h,f);if(e>this._units[f].incon){e=e/this._units[f].incon;g=this._units[f].u2;e=e.toFixed(1)}else{e=e.toFixed(0)}return e+g};d.prototype._setCursor=function(f){var e=/webkit/.test(navigator.userAgent.toLowerCase())?"url("+this._opts.cursor+") 3 6, crosshair":"url("+this._opts.cursor+"), crosshair";a._setCursor(e)};d.prototype._getCursor=function(){return this._opts.cursor};d.prototype._formatSegLabel=function(e,f){e.setStyle({border:"none",padding:"0"});e.setContent("<span style='"+this._styles.BMapLib_diso+"'><span style='"+this._styles.BMapLib_disi+"'>"+f+"</span></span>")};d.prototype._processLastOp=function(){var i=this;delete i._bind.x;delete i._bind.y;delete i._bind.initX;delete i._bind.initY;if(i._paths.length>i._points.length-1){var g=i._paths.length-1;i._paths[g].remove();i._paths[g]=null;i._paths.length=g}var e={};e.points=i._points.slice(0);e.paths=i._paths.slice(0);e.dots=i._dots.slice(0);e.segDis=i._segDistance.slice(0);var j=i._map.pointToPixel(e.points[e.points.length-1]);var h=i._map.pointToPixel(e.points[e.points.length-2]);var k=[0,0];var f=[0,0];if(j.y-h.y>=0){f=[-5,11]}else{f=[-5,-35]}if(j.x-h.x>=0){k=[14,0]}else{k=[-14,0]}var n=e.points[e.points.length-1];n.disLabel=new BMap.Label("",{offset:new BMap.Size(-15,-40),enableMassClear:i._enableMassClear});n.disLabel.setStyles({color:"#333",borderColor:"#ff0103"});i._map.addOverlay(n.disLabel);n.disLabel.setOffset(new BMap.Size(f[0],f[1]));n.disLabel.setPosition(n);i._formatTitle(2,"","",n.disLabel);var m=this._opts.closeIcon?this._opts.closeIcon:new BMap.Icon("http://api.map.baidu.com/images/mapctrls.gif",new BMap.Size(12,12),{imageOffset:new BMap.Size(0,-14)});e.closeBtn=new BMap.Marker(e.points[e.points.length-1],{icon:m,offset:new BMap.Size(k[0],k[1]),baseZIndex:3600000,enableMassClear:i._enableMassClear});i._map.addOverlay(e.closeBtn);e.closeBtn.setTitle("\u6e05\u9664\u672c\u6b21\u6d4b\u8ddd");e.closeBtn.addEventListener("click",function(r){for(var p=0,o=e.points.length;p<o;p++){e.points[p].disLabel.remove();e.points[p].disLabel=null}for(var p=0,o=e.paths.length;p<o;p++){e.paths[p].remove();e.paths[p]=null}for(var p=0,o=e.dots.length;p<o;p++){e.dots[p].remove();e.dots[p]=null}e.closeBtn.remove();e.closeBtn=null;b(r);var q=new c.lang.Event("onremovepolyline");i.dispatchEvent(q)});i._initData()};d.prototype._formatTitle=function(g,l,e,i){var h=i||this._followTitle;if(!h){return}h.setStyle({lineHeight:"16px",zIndex:"85",padding:"3px 5px"});var n=this._startFollowText||"";var k=[];if(g==1){h.setOffset(0,25);var m=this._opts.unit;var j=this._units[m].u1;var f=this._convertUnit(e,m);if(f>this._units[m].incon){f=f/this._units[m].incon;j=this._units[m].u2;f=f.toFixed(1)}else{f=f.toFixed(0)}k.push("<span>\u603b\u957f\uff1a<span style='"+this._styles.BMapLib_disBoxDis+"'>"+f+"</span>"+j+"</span><br />");k.push("<span style='color:#7a7a7a'>"+l+"</span>")}else{if(g==2){var m=this._opts.unit;var j=this._units[m].u1;var f=this._convertUnit(this._getTotalDistance(),m);if(f>this._units[m].incon){f=f/this._units[m].incon;j=this._units[m].u2;f=f.toFixed(1)}else{f=f.toFixed(0)}k.push("\u603b\u957f\uff1a<span style='"+this._styles.BMapLib_disBoxDis+"'>"+f+"</span>"+j)}else{h.setOffset(0,25);k.push(n)}}h.setContent(k.join(""))};d.prototype._updateInstDis=function(g,e){var f=this._opts.unit;var i=this._units[f].u1;if(e>this._units[f].incon){e=e/this._units[f].incon;i=this._units[f].u2;e=e.toFixed(1)}else{e=e.toFixed(0)}if(g){var h=[];h.push("<span>\u603b\u957f\uff1a<span style='"+this._styles.BMapLib_disBoxDis+"'>"+e+"</span>"+i+"</span><br />");h.push("<span style='color:#7a7a7a'>"+this._opts.followText+"</span>");g.setContent(h.join(""))}};d.prototype._hideCurrent=function(){if(!this._isOpen){return}if(this._paths.length>0){var e=this._paths[this._paths.length-1];e.hide()}this._followTitle&&this._followTitle.hide()};d.prototype._isPointValid=function(h){if(!h){return false}var f=this._map.getBounds();var e=f.getSouthWest(),g=f.getNorthEast();if(h.lng<e.lng||h.lng>g.lng||h.lat<e.lat||h.lat>g.lat){return false}return true};var a={_map:null,_html:"<div style='background:transparent url(http://api.map.baidu.com/images/blank.gif);position:absolute;left:0;top:0;width:100%;height:100%;z-index:1000' unselectable='on'></div>",_maskElement:null,_cursor:"default",_inUse:false,show:function(e){if(!this._map){this._map=e}this._inUse=true;if(!this._maskElement){this._createMask(e)}this._maskElement.style.display="block"},_createMask:function(g){this._map=g;if(!this._map){return}c.insertHTML(this._map.getContainer(),"beforeEnd",this._html);var f=this._maskElement=this._map.getContainer().lastChild;var e=function(h){b(h);return c.preventDefault(h)};c.on(f,"mouseup",function(h){if(h.button==2){e(h)}});c.on(f,"contextmenu",e);f.style.display="none"},getDrawPoint:function(h,j){h=window.event||h;var f=h.layerX||h.offsetX||0;var i=h.layerY||h.offsetY||0;var g=h.target||h.srcElement;if(g!=a.getDom(this._map)&&j==true){while(g&&g!=this._map.getContainer()){if(!(g.clientWidth==0&&g.clientHeight==0&&g.offsetParent&&g.offsetParent.nodeName.toLowerCase()=="td")){f+=g.offsetLeft;i+=g.offsetTop}g=g.offsetParent}}if(g!=a.getDom(this._map)&&g!=this._map.getContainer()){return}if(typeof f==="undefined"||typeof i==="undefined"){return}if(isNaN(f)||isNaN(i)){return}return this._map.pixelToPoint(new BMap.Pixel(f,i))},hide:function(){if(!this._map){return}this._inUse=false;if(this._maskElement){this._maskElement.style.display="none"}},getDom:function(e){if(!this._maskElement){this._createMask(e)}return this._maskElement},_setCursor:function(e){this._cursor=e||"default";if(this._maskElement){this._maskElement.style.cursor=this._cursor}}};function b(f){var f=window.event||f;f.stopPropagation?f.stopPropagation():f.cancelBubble=true}})();(function(){var e=0;var j=1;var c=BMapLib.RectangleZoom=function(n,m){if(!n){return}this._map=n;this._bounds=null;this._opts={zoomType:e,followText:"",strokeWeight:2,strokeColor:"#111",style:"solid",fillColor:"#ccc",opacity:0.4,cursor:"crosshair",autoClose:false};this._setOptions(m);this._opts.strokeWeight=this._opts.strokeWeight<=0?1:this._opts.strokeWeight;this._opts.opacity=this._opts.opacity<0?0:this._opts.opacity>1?1:this._opts.opacity;if(this._opts.zoomType<e||this._opts.zoomType>j){this._opts.zoomType=e}this._isOpen=false;this._fDiv=null;this._followTitle=null};c.prototype._setOptions=function(m){if(!m){return}for(var n in m){if(typeof(m[n])!="undefined"){this._opts[n]=m[n]}}};c.prototype.setStrokeColor=function(m){if(typeof m=="string"){this._opts.strokeColor=m;this._updateStyle()}};c.prototype.setLineStroke=function(m){if(typeof m=="number"&&Math.round(m)>0){this._opts.strokeWeight=Math.round(m);this._updateStyle()}};c.prototype.setLineStyle=function(m){if(m=="solid"||m=="dashed"){this._opts.style=m;this._updateStyle()}};c.prototype.setOpacity=function(m){if(typeof m=="number"&&m>=0&&m<=1){this._opts.opacity=m;this._updateStyle()}};c.prototype.setFillColor=function(m){this._opts.fillColor=m;this._updateStyle()};c.prototype.setCursor=function(m){this._opts.cursor=m;f.setCursor(this._opts.cursor)};c.prototype._updateStyle=function(){if(this._fDiv){this._fDiv.style.border=[this._opts.strokeWeight,"px ",this._opts.style," ",this._opts.color].join("");var m=this._fDiv.style,n=this._opts.opacity;m.opacity=n;m.MozOpacity=n;m.KhtmlOpacity=n;m.filter="alpha(opacity="+(n*100)+")"}};c.prototype.getBounds=function(){return this._bounds};c.prototype.getCursor=function(){return this._opts.cursor};c.prototype._bind=function(){this.setCursor(this._opts.cursor);var n=this;d(this._map.getContainer(),"mousemove",function(q){if(!n._isOpen){return}if(!n._followTitle){return}q=window.event||q;var o=q.target||q.srcElement;if(o!=f.getDom(n._map)){n._followTitle.hide();return}if(!n._mapMoving){n._followTitle.show()}var p=f.getDrawPoint(q,true);n._followTitle.setPosition(p)});if(this._opts.followText){var m=this._followTitle=new BMap.Label(this._opts.followText,{offset:new BMap.Size(14,16)});this._followTitle.setStyles({color:"#333",borderColor:"#ff0103"})}};c.prototype.open=function(){if(this._isOpen==true){return true}if(!!BMapLib._toolInUse){return}this._isOpen=true;BMapLib._toolInUse=true;if(!this.binded){this._bind();this.binded=true}if(this._followTitle){this._map.addOverlay(this._followTitle);this._followTitle.hide()}var o=this;var p=this._map;var q=0;if(/msie (\d+\.\d)/i.test(navigator.userAgent)){q=document.documentMode||+RegExp["\x241"]}var n=function(s){s=window.event||s;if(s.button!=0&&!q||q&&s.button!=1){return}if(!!q&&f.getDom(p).setCapture){f.getDom(p).setCapture()}if(!o._isOpen){return}o._bind.isZooming=true;d(document,"mousemove",m);d(document,"mouseup",r);o._bind.mx=s.layerX||s.offsetX||0;o._bind.my=s.layerY||s.offsetY||0;o._bind.ix=s.pageX||s.clientX||0;o._bind.iy=s.pageY||s.clientY||0;a(f.getDom(p),"beforeBegin",o._generateHTML());o._fDiv=f.getDom(p).previousSibling;o._fDiv.style.width="0";o._fDiv.style.height="0";o._fDiv.style.left=o._bind.mx+"px";o._fDiv.style.top=o._bind.my+"px";b(s);return h(s)};var m=function(z){if(o._isOpen==true&&o._bind.isZooming==true){var z=window.event||z;var u=z.pageX||z.clientX||0;var s=z.pageY||z.clientY||0;var w=o._bind.dx=u-o._bind.ix;var t=o._bind.dy=s-o._bind.iy;var v=Math.abs(w)-o._opts.strokeWeight;var y=Math.abs(t)-o._opts.strokeWeight;o._fDiv.style.width=(v<0?0:v)+"px";o._fDiv.style.height=(y<0?0:y)+"px";var x=[p.getSize().width,p.getSize().height];if(w>=0){o._fDiv.style.right="auto";o._fDiv.style.left=o._bind.mx+"px";if(o._bind.mx+w>=x[0]-2*o._opts.strokeWeight){o._fDiv.style.width=x[0]-o._bind.mx-2*o._opts.strokeWeight+"px";o._followTitle&&o._followTitle.hide()}}else{o._fDiv.style.left="auto";o._fDiv.style.right=x[0]-o._bind.mx+"px";if(o._bind.mx+w<=2*o._opts.strokeWeight){o._fDiv.style.width=o._bind.mx-2*o._opts.strokeWeight+"px";o._followTitle&&o._followTitle.hide()}}if(t>=0){o._fDiv.style.bottom="auto";o._fDiv.style.top=o._bind.my+"px";if(o._bind.my+t>=x[1]-2*o._opts.strokeWeight){o._fDiv.style.height=x[1]-o._bind.my-2*o._opts.strokeWeight+"px";o._followTitle&&o._followTitle.hide()}}else{o._fDiv.style.top="auto";o._fDiv.style.bottom=x[1]-o._bind.my+"px";if(o._bind.my+t<=2*o._opts.strokeWeight){o._fDiv.style.height=o._bind.my-2*o._opts.strokeWeight+"px";o._followTitle&&o._followTitle.hide()}}b(z);return h(z)}};var r=function(A){if(o._isOpen==true){i(document,"mousemove",m);i(document,"mouseup",r);if(!!q&&f.getDom(p).releaseCapture){f.getDom(p).releaseCapture()}var v=parseInt(o._fDiv.style.left)+parseInt(o._fDiv.style.width)/2;var u=parseInt(o._fDiv.style.top)+parseInt(o._fDiv.style.height)/2;var z=[p.getSize().width,p.getSize().height];if(isNaN(v)){v=z[0]-parseInt(o._fDiv.style.right)-parseInt(o._fDiv.style.width)/2}if(isNaN(u)){u=z[1]-parseInt(o._fDiv.style.bottom)-parseInt(o._fDiv.style.height)/2}var C=Math.min(z[0]/Math.abs(o._bind.dx),z[1]/Math.abs(o._bind.dy));C=Math.floor(C);var x=new BMap.Pixel(v-parseInt(o._fDiv.style.width)/2,u-parseInt(o._fDiv.style.height)/2);var w=new BMap.Pixel(v+parseInt(o._fDiv.style.width)/2,u+parseInt(o._fDiv.style.height)/2);var F=p.pixelToPoint(x);var E=p.pixelToPoint(w);var y=new BMap.Bounds(F,E);o._bounds=y;delete o._bind.dx;delete o._bind.dy;delete o._bind.ix;delete o._bind.iy;if(!isNaN(C)){if(o._opts.zoomType==e){targetZoomLv=Math.round(p.getZoom()+(Math.log(C)/Math.log(2)));if(targetZoomLv<p.getZoom()){targetZoomLv=p.getZoom()}}else{targetZoomLv=Math.round(p.getZoom()+(Math.log(1/C)/Math.log(2)));if(targetZoomLv>p.getZoom()){targetZoomLv=p.getZoom()}}}else{targetZoomLv=p.getZoom()+(o._opts.zoomType==e?1:-1)}var s=p.pixelToPoint({x:v,y:u},p.getZoom());p.centerAndZoom(s,targetZoomLv);var I=f.getDrawPoint(A);if(o._followTitle){o._followTitle.setPosition(I);o._followTitle.show()}o._bind.isZooming=false;o._fDiv.parentNode.removeChild(o._fDiv);o._fDiv=null}var t=y.getSouthWest(),B=y.getNorthEast(),G=new BMap.Point(B.lng,t.lat),H=new BMap.Point(t.lng,B.lat),D=new BMap.Polygon([t,H,B,G]);D.setStrokeWeight(2);D.setStrokeOpacity(0.3);D.setStrokeColor("#111");D.setFillColor("");p.addOverlay(D);new g({duration:240,fps:20,delay:500,render:function(K){var J=0.3*(1-K);D.setStrokeOpacity(J)},finish:function(){p.removeOverlay(D);D.dispose();D=null}});if(o._opts.autoClose){setTimeout(function(){if(o._isOpen==true){o.close()}},70)}b(A);return h(A)};f.show(this._map);this.setCursor(this._opts.cursor);if(!this._isBeginDrawBinded){d(f.getDom(this._map),"mousedown",n);this._isBeginDrawBinded=true}return true};c.prototype.close=function(){this._bounds=null;if(!this._isOpen){return}this._isOpen=false;BMapLib._toolInUse=false;this._followTitle&&this._followTitle.hide();f.hide()};c.prototype._generateHTML=function(){return["<div style='position:absolute;z-index:300;border:",this._opts.strokeWeight,"px ",this._opts.style," ",this._opts.strokeColor,"; opacity:",this._opts.opacity,"; background: ",this._opts.fillColor,"; filter:alpha(opacity=",Math.round(this._opts.opacity*100),"); width:0; height:0; font-size:0'></div>"].join("")};function a(p,m,o){var n,q;if(p.insertAdjacentHTML){p.insertAdjacentHTML(m,o)}else{n=p.ownerDocument.createRange();m=m.toUpperCase();if(m=="AFTERBEGIN"||m=="BEFOREEND"){n.selectNodeContents(p);n.collapse(m=="AFTERBEGIN")}else{q=m=="BEFOREBEGIN";n[q?"setStartBefore":"setEndAfter"](p);n.collapse(q)}n.insertNode(n.createContextualFragment(o))}return p}function k(n,m){a(n,"beforeEnd",m);return n.lastChild}function b(m){var m=window.event||m;m.stopPropagation?m.stopPropagation():m.cancelBubble=true}function h(m){var m=window.event||m;m.preventDefault?m.preventDefault():m.returnValue=false;return false}function d(m,n,o){if(!m){return}n=n.replace(/^on/i,"").toLowerCase();if(m.addEventListener){m.addEventListener(n,o,false)}else{if(m.attachEvent){m.attachEvent("on"+n,o)}}}function i(m,n,o){if(!m){return}n=n.replace(/^on/i,"").toLowerCase();if(m.removeEventListener){m.removeEventListener(n,o,false)}else{if(m.detachEvent){m.detachEvent("on"+n,o)}}}var f={_map:null,_html:"<div style='background:transparent url(http://api.map.baidu.com/images/blank.gif);position:absolute;left:0;top:0;width:100%;height:100%;z-index:1000' unselectable='on'></div>",_maskElement:null,_cursor:"default",_inUse:false,show:function(m){if(!this._map){this._map=m}this._inUse=true;if(!this._maskElement){this._createMask(m)}this._maskElement.style.display="block"},_createMask:function(o){this._map=o;if(!this._map){return}var n=this._maskElement=k(this._map.getContainer(),this._html);var m=function(p){b(p);return h(p)};d(n,"mouseup",function(p){if(p.button==2){m(p)}});d(n,"contextmenu",m);n.style.display="none"},getDrawPoint:function(p,r){p=window.event||p;var m=p.layerX||p.offsetX||0;var q=p.layerY||p.offsetY||0;var o=p.target||p.srcElement;if(o!=f.getDom(this._map)&&r==true){while(o&&o!=this._map.getContainer()){if(!(o.clientWidth==0&&o.clientHeight==0&&o.offsetParent&&o.offsetParent.nodeName.toLowerCase()=="td")){m+=o.offsetLeft;q+=o.offsetTop}o=o.offsetParent}}if(o!=f.getDom(this._map)&&o!=this._map.getContainer()){return}if(typeof m==="undefined"||typeof q==="undefined"){return}if(isNaN(m)||isNaN(q)){return}return this._map.pixelToPoint(new BMap.Pixel(m,q))},hide:function(){if(!this._map){return}this._inUse=false;if(this._maskElement){this._maskElement.style.display="none"}},getDom:function(m){if(!this._maskElement){this._createMask(m)}return this._maskElement},setCursor:function(m){this._cursor=m||"default";if(this._maskElement){this._maskElement.style.cursor=this._cursor}}};function g(p){var m={duration:1000,fps:30,delay:0,transition:l.linear,onStop:function(){}};if(p){for(var n in p){m[n]=p[n]}}this._opts=m;if(m.delay){var o=this;setTimeout(function(){o._beginTime=new Date().getTime();o._endTime=o._beginTime+o._opts.duration;o._launch()},m.delay)}else{this._beginTime=new Date().getTime();this._endTime=this._beginTime+this._opts.duration;this._launch()}}g.prototype._launch=function(){var n=this;var m=new Date().getTime();if(m>=n._endTime){if(typeof n._opts.render=="function"){n._opts.render(n._opts.transition(1))}if(typeof n._opts.finish=="function"){n._opts.finish()}return}n.schedule=n._opts.transition((m-n._beginTime)/n._opts.duration);if(typeof n._opts.render=="function"){n._opts.render(n.schedule)}if(!n.terminative){n._timer=setTimeout(function(){n._launch()},1000/n._opts.fps)}};var l={linear:function(m){return m},reverse:function(m){return 1-m},easeInQuad:function(m){return m*m},easeInCubic:function(m){return Math.pow(m,3)},easeOutQuad:function(m){return -(m*(m-2))},easeOutCubic:function(m){return Math.pow((m-1),3)+1},easeInOutQuad:function(m){if(m<0.5){return m*m*2}else{return -2*(m-2)*m-1}return},easeInOutCubic:function(m){if(m<0.5){return Math.pow(m,3)*4}else{return Math.pow(m-1,3)*4+1}},easeInOutSine:function(m){return(1-Math.cos(Math.PI*m))/2}}})();
