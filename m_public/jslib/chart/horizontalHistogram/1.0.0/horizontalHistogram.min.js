(function(a,b){if(typeof define==="function"){define("chart/horizontalHistogram/1.0.0/horizontalHistogram",[],function(){return b(a)})}else{if(typeof exports==="object"){module.exports=b(a)}else{a.HorizontalHistogram1=b(a)}}})(window,function(a){var c=a.jQuery;if(!c){console.log("没有引入jquery或者该js文件引入位置在jquery引入之前!")}function b(f,e,g){this.dataArr=f;this.opt=g;this.drawApi=e;this.loop=0;this.over=false;this.addArr=[];this.maxValue=1;this.textWidth=0;this.init()}b.prototype={init:function(){var j=this;j.drawApi.save();j.drawApi.font=j.opt.leftfontSize+j.opt.fontFamily;var e=j.dataArr.length;for(var g=0;g<e;g++){if(j.textWidth<j.drawApi.measureText(j.dataArr[g][j.opt.charNameObj.name]).width){j.textWidth=j.drawApi.measureText(j.dataArr[g][j.opt.charNameObj.name]).width}if(j.maxValue<parseFloat(j.dataArr[g][j.opt.charNameObj.value])){j.maxValue=parseFloat(j.dataArr[g][j.opt.charNameObj.value])}}j.textWidth+=j.opt.border*2;j.drawApi.restore();var h=j.maxValue.toString().split(".")[0];e=h.length;var f=(parseInt(h.charAt(0))+1).toString();for(g=1;g<e;g++){f+="0"}j.maxValue=parseInt(f)},add:function(){var g=this;g.addArr=[];g.loop++;var e=g.dataArr.length;for(var f=0;f<e;f++){var h=(g.loop/g.opt.steps)*(parseFloat(g.dataArr[f][g.opt.charNameObj.value])/g.maxValue);g.addArr.push(h.toFixed(3))}if(g.loop>=g.opt.steps){console.log("over");g.over=true}}};function d(f){this.options={id:"#horizontalHistogram",width:640,steps:30,space:5,leftfontSize:"24px",downfontSize:"16px",fontFamily:" Arial",valueFontColor:"#000",leftFontColor:"#000",downFontColor:"#000",bgLineColor:"#aaa",border:20,barHeight:20,cityHeight:50,downFontTop:10,charNameObj:{name:"name",value:"value"},randomBarColorArr:["#c3d69b","#fac090","#b7dee8"],dataArr:[{name:"北京",value:"19"},{name:"乌鲁木齐",value:"999"},{name:"北京",value:"200"},{name:"呼和浩特",value:"999"}]};for(var e in f){this.options[e]=f[e]}this.init()}d.prototype={init:function(){var g=this;g.con=c(g.options.id);g.con.css({overflow:"visible",transform:"translateZ(0)","-webkit-transform":"translateZ(0)"});g.cvs=c("<canvas></canvas>");g.drawApi=g.cvs[0].getContext("2d");g.isOprera=false;var f=a.navigator.userAgent.toLowerCase();if(/opr/.test(f)||/miuiyellowpage/.test(f)){var h=f.indexOf("android");if(h!=-1){var e=f.substr(h+8,3).split(".");if(parseFloat(e[0]+e[1])<42){g.isOprera=true}}}g.cvs[0].width=g.options.width*2;g.cvs.css("width",g.options.width.toString()+"px");g.fillData(g.options.dataArr);g.con.append(g.cvs)},fillData:function(f){var g=this;var e=f.length;g.height=e*g.options.cityHeight+parseFloat(g.options.downfontSize)+g.options.downFontTop;g.cvs[0].height=g.height;g.cvs.css("height",g.height/2+"px");g.block=new b(f,g.drawApi,g.options)},run:function(){var e=this;a.requestAnimationFrame(function(){e.animation()})},animation:function(){var e=this;e.drawApi.clearRect(0,0,e.cvs[0].width,e.cvs[0].height);e.block.add();e.drawBg(e.block);e.drawBar(e.block);if(e.isOprera){e.cvs.detach();e.con.append(e.cvs)}if(!e.block.over){e.run()}},drawBar:function(h){var n=this;n.drawApi.save();n.drawApi.font=n.options.leftfontSize+n.options.fontFamily;n.drawApi.textAlign="center";n.drawApi.textBaseline="middle";n.drawApi.fillStyle=n.options.leftFontColor;var f=h.dataArr;var m=h.addArr;var j=m.length;for(var k=0;k<j;k++){n.drawApi.fillText(f[k][n.options.charNameObj.name],h.textWidth/2,k*n.options.cityHeight+n.options.cityHeight/2);n.drawApi.save();var g=f[k].color?f[k].color:n.options.randomBarColorArr[k%n.options.randomBarColorArr.length];n.drawApi.fillStyle=g;n.drawApi.beginPath();var e=m[k]*(n.cvs[0].width-h.textWidth-n.options.border*2);n.drawApi.fillRect(h.textWidth,k*n.options.cityHeight+(n.options.cityHeight-n.options.barHeight)/2,e,n.options.barHeight);n.drawApi.fill();n.drawApi.restore();n.drawApi.save();n.drawApi.font=n.options.downfontSize+n.options.fontFamily;var o=h.textWidth+e;if(parseFloat(n.drawApi.measureText(f[k][n.options.charNameObj.name]).width)+20>=e){n.drawApi.textAlign="left";o+=10}else{n.drawApi.textAlign="right";o-=10}n.drawApi.textBaseline="middle";n.drawApi.fillStyle=n.options.valueFontColor;n.drawApi.fillText(f[k][n.options.charNameObj.value],o,k*n.options.cityHeight+n.options.cityHeight/2);n.drawApi.restore()}},drawBg:function(e){var g=this;g.drawApi.save();g.drawApi.font=g.options.downfontSize+g.options.fontFamily;g.drawApi.textAlign="center";g.drawApi.textBaseline="top";g.drawApi.fillStyle=g.options.downFontColor;for(var f=0;f<=g.options.space;f++){g.drawApi.beginPath();g.drawApi.strokeStyle=g.options.bgLineColor;g.drawApi.moveTo(e.textWidth+f*(g.cvs[0].width-e.textWidth-g.options.border*2)/g.options.space,0);g.drawApi.lineTo(e.textWidth+f*(g.cvs[0].width-e.textWidth-g.options.border*2)/g.options.space,e.dataArr.length*g.options.cityHeight);g.drawApi.stroke();g.drawApi.fillText((f*e.maxValue/g.options.space).toString(),e.textWidth+f*(g.cvs[0].width-e.textWidth-g.options.border*2)/g.options.space,e.dataArr.length*g.options.cityHeight+g.options.downFontTop)}g.drawApi.restore()}};return d});