(function(a,b){if(typeof define==="function"){define("chart/line/5.0.0/line",[],function(){return b(a)})}else{if(typeof exports==="object"){module.exports=b(a)}else{window.Line5=b(a)}}})(window,function(b){var f=b.jQuery;if(!f){console.log("没有引入jquery或者该js文件引入位置在jquery引入之前!")}var c=new Date();function e(g,h){this.x=g;this.y=h}function d(i,h,g){this.dataArr=i;this.drawApi=g;this.pArr=[];this.opt=h;this.unitWidth=0;this.clipWidth=0;this.loop=0;this.fullScale=1;this.max=0;this.min=0;this.over=false;this.init()}d.prototype={init:function(){var o=this;if(o.dataArr.length==1){this.pArr.push(new e(0,0));console.log("one data,error");return}var g=o.dataArr.length;o.max=o.min=parseFloat(o.dataArr[0][o.opt.charNameObj.value]);for(var m=1;m<g;m++){var h=o.dataArr[m][o.opt.charNameObj.name];var k=h.split(".");if(parseInt(k[0])===parseInt(c.getMonth())+1&&parseInt(k[1])>=parseInt(c.getDate())){break}var p=parseFloat(o.dataArr[m][o.opt.charNameObj.value]);if(o.max<p){o.max=p}if(o.min>p){o.min=p}}var n=o.max.toString().split(".")[0];g=n.length;var j=(parseInt(n.charAt(0))+1).toString();for(m=1;m<g;m++){j+="0"}j+=".0";o.fullScale=parseInt(j);o.drawApi.save();o.drawApi.font=o.opt.leftFontSize+o.opt.fontFamily;o.textWidth=o.drawApi.measureText(j).width;o.textWidth+=o.opt.border*2;o.drawApi.restore();g=o.dataArr.length;o.unitWidth=Math.floor((o.opt.width*2-o.textWidth-o.opt.rightBorder)/(g-1));for(m=0;m<g;m++){o.pArr.push(new e(o.textWidth+m*o.unitWidth,(o.opt.portHeight*o.opt.scaleNumber)*(1-(parseFloat(o.dataArr[m][o.opt.charNameObj.value])/o.fullScale))+o.opt.portHeight/2))}},add:function(){var g=this;g.loop++;g.clipWidth=Math.floor(g.opt.width*2)*(g.loop/g.opt.steps);if(g.loop>=g.opt.steps){g.over=true}}};function a(h){this.options={id:"#line",height:200,width:640,steps:60,linePx:2,scaleNumber:5,border:10,fontFamily:" Arial",leftFontSize:"24px",leftFontColor:"#999",downFontSize:"24px",downFontColor:"#999",maxFontColor:"#ff3d3d",minFontColor:"#56b229",lineColor:"#4477d5",rightBorder:30,pointRadius:5,downFontLeftMoveX:20,bgLineColor:"#ccc",charNameObj:{name:"name",value:"value",show:"isShow"},dataArr:[{name:"7.24",value:40000},{name:"7.25",value:30000},{name:"7.26",value:18000},{name:"7.27",value:21000},{name:"7.28",value:10000},{name:"8.21",value:55500},{name:"8.22",value:40000}]};for(var g in h){this.options[g]=h[g]}this.init()}a.prototype={init:function(){var i=this;i.con=f(i.options.id);i.con.css({overflow:"visible",transform:"translateZ(0)","-webkit-transform":"translateZ(0)"});i.cvs=f("<canvas></canvas>");i.drawApi=this.cvs[0].getContext("2d");i.drawLineClass=null;i.pointArr=[];i.isOprera=false;var h=b.navigator.userAgent.toLowerCase();if(/opr/.test(h)||/miuiyellowpage/.test(h)){var j=h.indexOf("android");if(j!=-1){var g=h.substr(j+8,3).split(".");if(parseFloat(g[0]+g[1])<42){i.isOprera=true}}}i.cvs[0].width=i.options.width*2;i.cvs[0].height=i.options.height*2;i.options.portHeight=Math.floor(i.cvs[0].height/(i.options.scaleNumber+1));i.cvs.css("width",i.options.width+"px");i.cvs.css("height",i.options.height+"px");i.fillData(i.options.dataArr);i.con.append(i.cvs)},fillData:function(g){this.drawLineClass=new d(g,this.options,this.drawApi)},run:function(){var g=this;b.requestAnimationFrame(function(){g.animation()})},animation:function(){var g=this;g.drawApi.clearRect(0,0,g.cvs[0].width,g.cvs[0].height);g.drawLineClass.add();g.drawBg(g.drawLineClass);g.drawLine(g.drawLineClass);if(g.isOprera){g.cvs.detach();g.con.append(g.cvs)}if(!g.drawLineClass.over){g.run()}},drawBg:function(g){var j=this;j.drawApi.save();j.drawApi.font=j.options.leftFontSize+j.options.fontFamily;j.drawApi.textAlign="right";j.drawApi.textBaseline="top";j.drawApi.fillStyle=j.options.leftFontColor;for(var h=0;h<=j.options.scaleNumber;h++){var k=j.options.portHeight*(j.options.scaleNumber-h)+j.options.portHeight/2;if(h!==0){j.drawApi.fillText(((h*g.fullScale/j.options.scaleNumber).toFixed(1)).toString(),g.textWidth-j.options.border,k)}j.drawApi.save();j.drawApi.strokeStyle=j.options.bgLineColor;j.drawApi.beginPath();j.drawApi.moveTo(g.textWidth,k);j.drawApi.lineTo(g.textWidth+g.unitWidth*(g.pArr.length-1),k);j.drawApi.stroke();j.drawApi.restore()}},drawLine:function(s){var p=this;var k=s.pArr.length;for(var o=0;o<k;o++){var h=s.dataArr[o][p.options.charNameObj.name];var n=s.dataArr[o][p.options.charNameObj.show];if(n==="1"){p.drawApi.save();p.drawApi.strokeStyle=p.options.bgLineColor;p.drawApi.beginPath();p.drawApi.moveTo(s.textWidth+s.unitWidth*o,p.options.portHeight/2);p.drawApi.lineTo(s.textWidth+s.unitWidth*o,p.options.portHeight*p.options.scaleNumber+p.options.portHeight/2);p.drawApi.stroke();p.drawApi.restore();p.drawApi.save();p.drawApi.font=p.options.downFontSize+p.options.fontFamily;p.drawApi.textAlign="left";p.drawApi.textBaseline="bottom";p.drawApi.fillStyle=p.options.downFontColor;p.drawApi.fillText(h,s.textWidth+s.unitWidth*o-p.options.downFontLeftMoveX,p.options.portHeight*(p.options.scaleNumber+1));p.drawApi.restore()}p.drawApi.save();p.drawApi.rect(0,0,s.clipWidth,p.drawApi.canvas.height);p.drawApi.clip();if(o<k-1){var j=s.dataArr[o+1][p.options.charNameObj.name];var g=j.split(".");if(parseInt(g[0])<parseInt(c.getMonth())+1||parseInt(g[0])===parseInt(c.getMonth())+1&&parseInt(g[1])<parseInt(c.getDate())){p.drawApi.strokeStyle=p.options.lineColor;p.drawApi.lineWidth=p.options.linePx;p.drawApi.beginPath();p.drawApi.moveTo(s.pArr[o].x,s.pArr[o].y);p.drawApi.lineTo(s.pArr[o+1].x,s.pArr[o+1].y);p.drawApi.stroke()}}g=h.split(".");var q=false,m=0,r=s.dataArr[o][p.options.charNameObj.value];if(parseInt(g[0])<parseInt(c.getMonth())+1||parseInt(g[0])===parseInt(c.getMonth())+1&&parseInt(g[1])<parseInt(c.getDate())){if(parseFloat(r)===s.max){q=true;m=p.options.maxFontColor}if(q){p.drawApi.save();p.drawApi.fillStyle=p.options.lineColor;p.drawApi.beginPath();p.drawApi.arc(s.pArr[o].x,s.pArr[o].y,p.options.pointRadius,0,Math.PI*2,true);p.drawApi.closePath();p.drawApi.fill();p.drawApi.restore();p.drawApi.save();p.drawApi.font="bold26px"+p.options.fontFamily;p.drawApi.textAlign="center";p.drawApi.textBaseline="bottom";p.drawApi.fillStyle=m;p.drawApi.fillText(r,s.pArr[o].x,s.pArr[o].y-10);p.drawApi.restore()}}p.drawApi.restore()}}};return a});