/*!
 * jWing JavaScript Library v1.0.0
 * http://jwing.com/
 *
 * Includes jquery.js
 * http://jquery.com/
 *
 * Copyright 2013 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jwing.org/license
 *
 * Date: 2013-5-8
 * Auth: yueyanlei
 */
;define('jwingupload/1.0.0/jwingupload',["jquery"],function(require,d,a){var e=require("jquery");var f=window,j=f.document,l=f.location.hostname.split("."),g=l.length,i="1.0.0",o=[],h,c;j.domain=l[g-2]+"."+l[g-1];h=function(p){p=p||{};p=e.extend(true,{},h.defaults,p);return new h.fn.init(p)};c=(function(){if(navigator.userAgent.match(/(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(Windows Phone (OS 7|8.0))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1.0|2.0|2.5|3.0))/)){return false}var p=j.createElement("input");p.type="file";return !p.disabled})();h.fn=h.prototype={version:i,constructor:h,init:function(s){var w=this,u={},p=e(s.form),t=e(s.uploadPic),y=e(s.preview),r=e(s.iFrame),q=s.maxLength;w.hiddenImgList=[];w.imgList=[];t.css("display","inline-block");if(q!=undefined&&q>0){var x="<dl>";for(var v=0;v<q;v++){x+="<dd></dd>"}x+="</dl>";h._template=x}if(!c){t.empty();t.bind("click",function(){if(confirm("\u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u56FE\u7247\u4E0A\u4F20\uFF0C\u8BF7\u4E0B\u8F7D\u641C\u623Fapp\u4E0A\u4F20\u56FE\u7247")){var z=b("util");z.down()}});return this}this.dom=u;this.config=s;u.form=p;u.picBlock=t;u.preBlock=y;u.iFrame=r;u.input=e("<input/>").attr({type:"file",name:"pic",id:"pic",accept:"image/*","class":"upload-input"}).appendTo(t);u.uploadurl=p.attr("action");u.nowItem=null;u.input.bind("click",function(){var A=null,z=false;if(w.imgList.length<1){z=true}else{e.each(w.imgList,function(B,C){var D=C.dom;if(D.imgurl==""&&D.holder==false){A=C;z=true;return false}})}if(z==true){u.input.unbind("change").bind("change",{m:w,d:A},k)}else{u.input.unbind("change");alert("\u60A8\u5DF2\u7ECF\u9009\u62E9\u4E86"+w.imgList.length+"\u5F20\u56FE\u7247")}return z});return this},length:0,createPreview:function(){var p=this,q=p.dom;q.dl=e(h._template).appendTo(q.preBlock);q.preBlock.css("display","inline-block");q.dl.find("dd").attr({"class":"add"}).each(function(s,t){var r=e(t),u={};u.index=s;u.input=e("<input/>").attr({type:"file",name:"pic"+s,id:"pic"+s,accept:"image/*","class":"upload-input"}).appendTo(t).bind("change",{m:p,d:r},k);u.img=e('<img src="'+p.config.imgPath+'images/loading.gif" style="margin:10px 9px 9px 10px;width:31px; height:31px;">');u.closebtn=e('<a href="javascript:;">&#88;</a>');u.imgurl="";u.holder=false;r.dom=u;r.detach();p.hiddenImgList.push(r)})},push:o.push,sort:o.sort,splice:o.splice};h.fn.init.prototype=h.fn;var n=function(r,q){var p=r.dom.iFrame.get(0),s=q.dom;doc=p.contentDocument||p.contentWindow.document;r.holder=false;s.holder=false;if(doc&&doc.readyState&&doc.readyState=="complete"){s.imgurl=doc.getElementsByTagName("div")[0].innerHTML;if(s.imgurl){s.img.attr("src",s.imgurl);s.img.css({margin:"0px",width:"50px",height:"50px"});q.append(s.closebtn.unbind("click").bind("click",{m:r,d:q},m))}else{alert("\u4E0A\u4F20\u5931\u8D25\uFF0C\u8BF7\u91CD\u65B0\u4E0A\u4F20");m({m:r,d:q})}}};var k=function(v){var t=v.data,u=t.m,x=t.d,p=v.target.files,q=u.dom.form.get(0),r=u.dom.iFrame.get(0),w=v.target;if(p.length>0){if(u.holder==true){w.value="";alert("\u6709\u4E00\u5F20\u56FE\u7247\u6B63\u5728\u4E0A\u4F20\uFF0C\u8BF7\u5B8C\u6210\u540E\u518D\u8BD5");return false}if(u.imgList.length<1){u.createPreview();x=u.hiddenImgList.shift();u.imgList.push(x);u.dom.dl.append(x)}u.dom.preBlock.css("display","inline-block");x.dom.holder=true;if(u.hiddenImgList.length>0){var s=u.hiddenImgList.shift();u.imgList.push(s);u.dom.dl.append(s)}q.onsubmit=function(){return true};r.onload=function(){n(u,x)};q.action=u.dom.uploadurl+"&rand="+new Date().getTime();u.holder=true;q.submit();setTimeout(function(){w.value="";x.removeClass("add").empty().append(x.dom.img.attr("src",u.config.imgPath+"images/loading.gif").css({margin:"10px 9px 9px 10px",width:"31px",height:"31px"}))},10)}else{q.onsubmit=function(){return false}}};var m=function(s){var r=s.data,q=r.m,p=r.d;theindex=0;p.addClass("add").empty().append(p.dom.input.unbind("change").bind("change",{m:q,d:p},k));p.dom.imgurl="";e.each(q.imgList,function(u,v){if(v==p){theindex=u;return false}});if(theindex!=q.imgList.length-1){p.detach();q.imgList.splice(theindex,1);var t=0;e.each(q.imgList,function(u,v){var w=v.dom;if(w.imgurl!=""||w.holder==true){t++}});if(t==q.imgList.length){q.imgList.push(p);q.dom.dl.append(p)}else{q.hiddenImgList.push(p)}}if(q.imgList.length==1){q.dom.preBlock.hide()}};h.defaults={form:null,uploadPic:null,preview:null,iFrame:null};h._template="<dl><dd></dd><dd></dd><dd></dd><dd></dd></dl>";a.exports=h});