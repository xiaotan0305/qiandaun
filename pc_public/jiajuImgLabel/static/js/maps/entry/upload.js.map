{"version":3,"sources":["entry/upload.js"],"names":["define","require","$","Toast","title","message","type","options","callback","removeToast","remove","$element","$options","extend","appendTo","stack","position_class","fullscreen","width","spacing","timeout","has_close_btn","has_icon","sticky","border_radius","has_progress","rtl","css","position","min-width","display","border-radius","z-index","addClass","indexOf","find","each","parseInt","this","offsetHeight","fadeIn","$alert","opacity","setTimeout","animate","click","fadeOut","init","removeClass","hide","data","text","attr","selectFile","value","upload","form","f","FormData","ajax","url","vars","domainUp","processData","contentType","xhr","myXhr","ajaxSettings","uploadBtn","addEventListener","e","lengthComputable","percent","loaded","total","console","log","toFixed","success","res","code","msg","error","resStr","JSON","stringify","window","upDomain","onload","document","getElementById","file","target","files","fileName","name","size","test","html","show","off","on"],"mappings":"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","file":"../../entry/upload.js","sourcesContent":["define('toast', [], function (require) {\n    \"use strict\";\n\n    $.Toast = function (title, message, type, options, callback) {\n        var defaultOptions = {\n            appendTo: \"body\",\n            stack: false,\n            position_class: \"toast-top-right\",\n            fullscreen: false,\n            width: 250,\n            spacing: 20,\n            timeout: 2000,\n            has_close_btn: true,\n            has_icon: true,\n            sticky: false,\n            border_radius: 6,\n            has_progress: false,\n            rtl: false\n        };\n        type = type || 'success';\n        if (typeof options === 'function') {\n            callback = options;\n        }\n        if (typeof type === 'function') {\n            callback = type;\n            type = 'success';\n        }\n        var $element = null;\n\n        var $options = $.extend(true, {}, defaultOptions, options);\n\n        var spacing = $options.spacing;\n\n        var css = {\n            \"position\": $options.appendTo == \"body\" ? \"fixed\" : \"absolute\",\n            \"min-width\": $options.width,\n            \"display\": \"none\",\n            \"border-radius\": $options.border_radius,\n            \"z-index\": 99999\n        };\n\n        $element = $('<div class=\"toast-item-wrapper ' + type + ' ' + $options.position_class + '\"></div>');\n        $('<p class=\"toast-title\">' + title + '</p>').appendTo($element);\n        $('<p class=\"toast-message\">' + message + '</p>').appendTo($element);\n\n        if ($options.fullscreen) {\n            $element.addClass(\"fullscreen\");\n        }\n\n        if ($options.rtl) {\n            $element.addClass(\"rtl\");\n        }\n\n        if ($options.has_close_btn) {\n            $('<span class=\"toast-close\">&times;</span>').appendTo($element);\n            if ($options.rtl) {\n                css[\"padding-left\"] = 20;\n            } else {\n                css[\"padding-right\"] = 20;\n            }\n        }\n\n        if ($options.has_icon) {\n            $('<i class=\"toast-icon toast-icon-' + type + '\"></i>').appendTo($element);\n            if ($options.rtl) {\n                css[\"padding-right\"] = 50;\n            } else {\n                css[\"padding-left\"] = 50;\n            }\n        }\n\n        if ($options.has_progress && $options.timeout > 0) {\n            $('<div class=\"toast-progress\"></div>').appendTo($element);\n        }\n\n        if ($options.sticky) {\n            $options.spacing = 0;\n            spacing = 0;\n\n            switch ($options.position_class) {\n                case \"toast-top-left\":\n                    {\n                        css[\"top\"] = 0;\n                        css[\"left\"] = 0;\n                        break;\n                    }\n                case \"toast-top-right\":\n                    {\n                        css[\"top\"] = 0;\n                        css[\"left\"] = 0;\n                        break;\n                    }\n                case \"toast-top-center\":\n                    {\n                        css[\"top\"] = 0;\n                        css[\"left\"] = css[\"right\"] = 0;\n                        css[\"width\"] = \"100%\";\n                        break;\n                    }\n                case \"toast-bottom-left\":\n                    {\n                        css[\"bottom\"] = 0;\n                        css[\"left\"] = 0;\n                        break;\n                    }\n                case \"toast-bottom-right\":\n                    {\n                        css[\"bottom\"] = 0;\n                        css[\"right\"] = 0;\n                        break;\n                    }\n                case \"toast-bottom-center\":\n                    {\n                        css[\"bottom\"] = 0;\n                        css[\"left\"] = css[\"right\"] = 0;\n                        css[\"width\"] = \"100%\";\n                        break;\n                    }\n                default:\n                    {\n                        break;\n                    }\n            }\n        }\n\n        if ($options.stack) {\n            if ($options.position_class.indexOf(\"toast-top\") !== -1) {\n                $($options.appendTo).find('.toast-item-wrapper').each(function () {\n                    css[\"top\"] = parseInt($(this).css(\"top\")) + this.offsetHeight + spacing;\n                });\n            } else if ($options.position_class.indexOf(\"toast-bottom\") !== -1) {\n                $($options.appendTo).find('.toast-item-wrapper').each(function () {\n                    css[\"bottom\"] = parseInt($(this).css(\"bottom\")) + this.offsetHeight + spacing;\n                });\n            }\n        }\n\n        $element.css(css);\n\n        $element.appendTo($options.appendTo);\n\n        if ($element.fadeIn) {\n            $element.fadeIn();\n        } else {\n            $alert.css({ display: 'block', opacity: 1 });\n        }\n\n        function removeToast() {\n            $.Toast.remove($element, callback);\n        }\n\n        if ($options.timeout > 0) {\n            setTimeout(removeToast, $options.timeout);\n            if ($options.has_progress) {\n                $(\".toast-progress\", $element).animate({ \"width\": \"100%\" }, $options.timeout);\n            }\n        }\n\n        $(\".toast-close\", $element).click(removeToast);\n\n        return $element;\n    };\n\n    $.Toast.remove = function ($element, callback) {\n        \"use strict\";\n\n        if ($element.fadeOut) {\n            $element.fadeOut(function () {\n                $element.remove();\n                callback && callback();\n            });\n        } else {\n            $element.remove();\n            callback && callback();\n        }\n    };\n});\ndefine('entry/upload', ['toast'], function (require) {\n\n    var vars = window.vars;\n    var upDomain = vars.upDomain;\n\n    require('toast');\n\n    window.onload = function () {\n        $('.upload-content').addClass('select');\n    };\n\n    // 选中文件了以后\n    var selectFile = document.getElementById('selectFile');\n    selectFile && selectFile.addEventListener('change', function (e) {\n        var form = document.getElementById('form');\n        // 显示文件尺寸和文件名\n        var file = e.target.files[0];\n        if (!file) return;\n        var fileName = file.name;\n        var size = file.size / 1000;\n        if (!/.\\.txt$/.test(fileName)) {\n            $.Toast('上传失败', \"\\u76EE\\u524D\\u53EA\\u80FD\\u4E0A\\u4F20txt\\u683C\\u5F0F\\u6587\\u6863\", 'error', {\n                timeout: 1200\n            });\n            return;\n        }\n        $('#upload-tip').html(\"<p>\\u6587\\u4EF6\\u540D\\uFF1A\" + fileName + \"</p><p>\\u5C3A\\u5BF8\\uFF1A\" + size + \"kb</p>\").show();\n        // 隐藏文件图标，显示上传图标\n        $('.upload-content').removeClass('select').addClass('upload');\n        // 隐藏选择提示按钮\n        $('#btn-select').addClass('none');\n        // 显示上传按钮\n        $('#btn-upload').removeClass('none').off('click').on('click', function () {\n            // 让按钮失效，避免重复上传\n            if ($(this).data('disable') === 'true') {\n                return;\n            }\n            $(this).data('disable', 'true').text('上传中');\n            // 上传\n            upload(form);\n        });\n    }, false);\n\n    function init() {\n        $('.upload-content').removeClass('upload').addClass('select');\n        $('#upload-tip').hide();\n        // 隐藏选择提示按钮\n        $('#btn-select').removeClass('none');\n        $('#btn-upload').addClass('none');\n        $('#btn-upload').data('disable', 'false').text('点我上传');\n        $('.upload-btn').attr('style', '');\n        selectFile.value = '';\n    }\n\n    // 上传\n    function upload(form) {\n        var f = new FormData(form);\n        $.ajax({\n            url: vars.domainUp,\n            type: 'POST',\n            data: f,\n            processData: false,\n            contentType: false,\n            xhr: function xhr() {\n                var myXhr = $.ajaxSettings.xhr();\n                if (myXhr.upload) {\n                    var uploadBtn = $('.upload-btn');\n                    myXhr.upload.addEventListener('progress', function (e) {\n                        if (e.lengthComputable) {\n                            var percent = e.loaded / e.total * 100;\n                            console.log(\"\\u4E0A\\u4F20\\uFF1A + \" + e.loaded + \" + / + \" + e.total + \" +  bytes.  +\\n                                \" + percent.toFixed(2) + \" + %\");\n                            // 图标背景进度\n                            uploadBtn.css('backgroundPosition', '0 ' + percent.toFixed(2) + '%');\n                        }\n                    }, false);\n                }\n                return myXhr;\n            },\n            success: function success(res) {\n                // 如果上传成功\n                if (res.code === '100') {\n                    // 隐藏上传提示按钮\n                    $('#btn-upload').addClass('none');\n                    // 显示上传成功提示按钮\n                    $('#btn-done').removeClass('none');\n                    // 显示上传成功图标\n                    $('.upload-content').removeClass('upload').addClass('done');\n                    $.Toast('成功', res.msg, 'success', {\n                        timeout: 0\n                    });\n                } else {\n                    console.log(res.data);\n                    $.Toast('失败', res.msg, 'error', function () {\n                        init();\n                    });\n                }\n            },\n            error: function error(res) {\n                var resStr = JSON.stringify(res);\n                console.log('失败:' + resStr);\n                $.Toast('失败', resStr, 'error', function () {\n                    init();\n                });\n            }\n        });\n    }\n});"]}